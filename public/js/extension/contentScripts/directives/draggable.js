// Generated by CoffeeScript 1.6.3
(function() {
  var draggableDirective;

  draggableDirective = angular.module('draggableDirective', []);

  draggableDirective.directive('draggable', [
    '$document', function($document) {
      return {
        restrict: 'A',
        link: function(scope, element, attrs) {
          var header, initialMouseX, initialMouseY, mousemove, mouseup, startX, startY;
          header = angular.element("<div class='draggable-header' />");
          element.prepend(header);
          startY = scope.todo.clientY;
          startX = scope.todo.clientX;
          initialMouseX = 0;
          initialMouseY = 0;
          element.css({
            position: 'fixed',
            top: startY,
            left: startX
          });
          header.css({
            position: 'absolute'
          });
          mousemove = function($event) {
            var dx, dy;
            dx = $event.clientX - initialMouseX;
            dy = $event.clientY - initialMouseY;
            element.css({
              top: startY + dy + 'px',
              left: startX + dx + 'px'
            });
            return false;
          };
          mouseup = function() {
            var position;
            position = element.position();
            scope.todo.clientX = position.left;
            scope.todo.clientY = position.top;
            scope.$parent.updateTodo(scope.todo);
            $document.unbind('mousemove', mousemove);
            return $document.unbind('mouseup', mouseup);
          };
          return header.bind('mousedown', function($event) {
            startX = element.prop('offsetLeft');
            startY = element.prop('offsetTop');
            initialMouseX = $event.clientX;
            initialMouseY = $event.clientY;
            $document.bind('mousemove', mousemove);
            $document.bind('mouseup', mouseup);
            return false;
          });
        }
      };
    }
  ]);

  module.exports = draggableDirective;

}).call(this);
